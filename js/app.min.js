var page=0,startTime=(new Date).toUTCString(),id=Math.floor(1e4*Math.random()),db=null,dbEntryPath="survey-data-"+env+"/entries/entry_",dbOverviewPath="survey-data-"+env+"/overview/";function initDB(){db=firebase.database()}function initQuiz(){var t=$("#page"+page),e=$(".highlight-container.media-large .item");$(".page.load").removeClass("load"),t.addClass("show");for(var n=0;n<e.length;n++){var a=Math.floor(Math.random()*e.length-1)+1,r=Math.floor(Math.random()*e.length-1)+1;e.eq(a).before(e.eq(r))}randomizePage(),randomizeContent(++page)}function updateEntries(t){db.ref(dbEntryPath+id).update(t)}function changePage(t){var e=$("#page"+t);$(".page.show").removeClass("show"),e.addClass("show")}function nextPage(t){var e=$("#page"+page);1==page&&db.ref(dbOverviewPath+"total/participants/started").transaction(function(t){return null==t?1:t+1}),$("#page"+page+" .question-title").each(function(){$(this).text("Question "+(page-1))}),collectAndSendInputs(page,t),changePage(page),randomizeContent(++page),0!==$(e).find(".page-results").length&&displayResult()}function loadResultData(t){var e;db.ref(dbEntryPath+id+"/results/").once("value").then(function(n){e=n.val(),t(e)})}function loadOverviewData(t){var e;db.ref(dbOverviewPath).once("value").then(function(n){e=n.val(),t(e)})}function displayResult(){var t,e;db.ref(dbOverviewPath+"total/participants/completed").transaction(function(t){return null==t?1:t+1}),loadResultData(function(n){var a=(t=n).total.answered,r=t.total.correct||0,i=t.total.wrong||0;"production"==env&&analytics.logEvent("completed",{result:r+"/10",correct:r,wrong:i}),db.ref(dbOverviewPath+"total/answersCompleted/answers").transaction(function(t){return null==t?a:t+a}),db.ref(dbOverviewPath+"total/answersCompleted/correct").transaction(function(t){return null==t?r:t+r}),db.ref(dbOverviewPath+"total/answersCompleted/wrong").transaction(function(t){return null==t?i:t+i}),loadOverviewData(function(n){var i=0,o=(e=n).perContentType.image.answers,s=(e.perContentType.image.correct,e.perContentType.text.answers),d=(e.perContentType.text.correct,e.total.answers.answers,e.total.answers.correct,e.total.participants.completed),l=(e.total.answersCompleted.answers,(e.total.answersCompleted.correct/d).toFixed(0)),c=(o=e.perContentType.image.answers,(e.perContentType.image.correct/o*100).toFixed(0)),u=(s=e.perContentType.text.answers,(e.perContentType.text.correct/s*100).toFixed(0)),p=$("template#resultItem").html();$('span[data="correct"').text(r),$('span[data="answered"').text("/"+a),$('span[data="participants"').text(d),$('span[data="avgResult"').text(l+"/"+a),$('span[data="imagePercentage"').text(c),$('span[data="textPercentage"').text(u),$.map(t,function(t){if(i++,"id"in t){t.id;var n,a=t.contentId,r=t.contentType,o=t.result,s=t.validity,d=$("#"+a),l=d.attr("src"),c=$(d).find(".text-title > span").text(),u=$(d).find(".text-content > p").text(),v=e.perContent[r+"_"+a].answers,f=((e.perContent[r+"_"+a].correct||0)/v*100).toFixed(0),g=$(p);g.addClass(r),"text"==r?(g.find('div[data="contentTypeImage"]').css("display","none"),g.find('div[data="contentTypeText"] > .text-title > span').text(c),g.find('div[data="contentTypeText"] > .text-content > p').text(u),n="Written by "+s):"image"==r&&(g.find('div[data="contentTypeText"]').css("display","none"),g.find('img[data="contentImage"]').attr("src",l),"Humans"==s?n="A real Human":"AI"==s&&(n="Generated by "+s)),"Humans"==s?(g.find('div[data="validity"] img[value="ai"]').css("display","none"),g.find('div[data="validity"] > span').text(n),"correct"==o?g.find('div[data="guess"] > span').text("You guessed Human"):"wrong"==o&&g.find('div[data="guess"] > span').text("You guessed AI")):"AI"==s&&(g.find('div[data="validity"] img[value="human"]').css("display","none"),g.find('div[data="validity"] > span').text(n),"correct"==o?g.find('div[data="guess"] > span').text("You guessed AI"):"wrong"==o&&g.find('div[data="guess"] > span').text("You guessed Human")),g.find('div[data="result"]').addClass(o);for(var h=0;h<src[a].href.length;h++){var m=g.find('div[data="source"]');h>0&&$("<span/>",{text:" + "}).appendTo(m),$("<a/>",{target:"_blank",href:src[a].href[h],text:src[a].text[h]}).appendTo(m)}g.find('div[data="percentage"] > span').text(f+"% of users got it right"),"correct"==o?g.find('div[data="result"] > svg[value="wrong"]').css("display","none"):"wrong"==o&&g.find('div[data="result"] > svg[value="correct"]').css("display","none"),g.find('span[data="questionNumber"]').text("Question "+i),$(".result.breakdown").append(g)}})})})}function randomizeContent(t){for(var e=$("#page"+t+" .random"),n=0;n<e.length;n++){var a=Math.floor(Math.random()*e.length-1)+1,r=Math.floor(Math.random()*e.length-1)+1;e.eq(a).before(e.eq(r))}$("#page"+t+" .randomize > *:nth-child(2)").addClass("chosen");for(n=0;n<e.length;n++)$(e[n]).hasClass("chosen")||e[n].remove()}function randomizePage(){for(var t=$('.page[value="question"]'),e=2,n=0;n<t.length;n++){var a=Math.floor(Math.random()*t.length-1)+1,r=Math.floor(Math.random()*t.length-1)+1;t.eq(a).before(t.eq(r))}(t=$('.page[value="question"]')).each(function(){$(this).attr("id","page"+e),e++})}function collectAndSendInputs(t,e){var n=$(e),a="results/question_",r={},i=t-1,o=i-2;$("#page"+i+" .question").each(function(){var t,e=$(this),i=$(".chosen[question="+e.attr("id")+"]"),s=e.attr("id"),d=i.attr("id"),l=e.attr("type"),c="no answer";t=d%2==0?"AI":"Humans",$("input",e).each(function(){var t=$(this);r[a+o+"_"+s+"/"+t.attr("value")]="false",(t=n)&&(r[a+o+"_"+s+"/"+t.attr("value")]="true",c="selectsAI"==n.attr("value")&&d%2==0?"correct":"selectsHuman"==n.attr("value")&&1==Math.abs(d%2)?"correct":"wrong")});var u="perQuestion/question_"+s,p="perContent/"+l+"_"+d,v="perContentType/"+l;db.ref(dbOverviewPath+"total//answers/answers").transaction(function(t){return null==t?1:t+1}),db.ref(dbOverviewPath+"total//answers/"+c).transaction(function(t){return null==t?1:t+1}),db.ref(dbOverviewPath+u+"/answers").transaction(function(t){return null==t?1:t+1}),db.ref(dbOverviewPath+u+"/"+c).transaction(function(t){return null==t?1:t+1}),db.ref(dbOverviewPath+v+"/answers").transaction(function(t){return null==t?1:t+1}),db.ref(dbOverviewPath+v+"/"+c).transaction(function(t){return null==t?1:t+1}),db.ref(dbOverviewPath+p+"/answers").transaction(function(t){return null==t?1:t+1}),db.ref(dbOverviewPath+p+"/"+c).transaction(function(t){return null==t?1:t+1}),r.id=id,r.startTime=startTime,r.completeTime=(new Date).toUTCString(),r[a+o+"_"+s+"/id"]=s,r[a+o+"_"+s+"/contentId"]=d,r[a+o+"_"+s+"/contentType"]=l,r[a+o+"_"+s+"/validity"]=t,r[a+o+"_"+s+"/result"]=c,updateEntries(r),db.ref(dbEntryPath+id+"/results/total/answered").transaction(function(t){return null==t?1:t+1}),db.ref(dbEntryPath+id+"/results/total/"+c).transaction(function(t){return null==t?1:t+1})})}function animateFavicon(){var t=["assets/favicon-1.ico","assets/favicon-2.ico"],e=0;setInterval(function(){$("link[rel='icon']").remove(),$("link[rel='shortcut icon']").remove(),$("head").append('<link rel="icon" href="'+baseurl+t[e]+'" type="image/x-icon">'),e==t.length-1?e=0:e++},500)}function start(){initDB(),initQuiz(),animateFavicon()}